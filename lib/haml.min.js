(function(){var a,b,c,d,e,f,g=Object.prototype.hasOwnProperty;e=function(){function a(a){var b;this.buffer=null,this.bufferIndex=null,this.prevToken=null,this.token=null;if(a.templateId){b=document.getElementById(a.templateId);if(b)this.buffer=b.innerHTML,this.bufferIndex=0;else throw"Did not find a template with ID '"+a.templateId+"'"}else a.template&&(this.buffer=a.template,this.bufferIndex=0)}a.prototype.currentLineMatcher=/[^\n]*/g,a.prototype.tokenMatchers={whitespace:/[ \t]+/g,element:/%[a-zA-Z][a-zA-Z0-9]*/g,idSelector:/#[a-zA-Z_\-][a-zA-Z0-9_\-]*/g,classSelector:/\.[a-zA-Z0-9_\-]+/g,identifier:/[a-zA-Z][a-zA-Z0-9\-]*/g,quotedString:/[\'][^\'\n]*[\']/g,quotedString2:/[\"][^\"\n]*[\"]/g,comment:/\-#/g,escapeHtml:/\&=/g,unescapeHtml:/\!=/g,objectReference:/\[[a-zA-Z_][a-zA-Z0-9_]*\]/g,doctype:/!!!/g},a.prototype.matchToken=function(a){var b;a.lastIndex=this.bufferIndex,b=a.exec(this.buffer);if((b!=null?b.index:void 0)===this.bufferIndex)return b[0]},a.prototype.matchMultiCharToken=function(a,b,c){var d,e;if(!this.token){d=this.matchToken(a);if(d){this.token=b,this.token.tokenString=(e=typeof c=="function"?c(d):void 0)!=null?e:d,this.token.matched=d;return this.advanceCharsInBuffer(d.length)}}},a.prototype.matchSingleCharToken=function(a,b){if(!this.token&&this.buffer.charAt(this.bufferIndex)===a){this.token=b,this.token.tokenString=a,this.token.matched=a;return this.advanceCharsInBuffer(1)}},a.prototype.getNextToken=function(){var a,b,c,d,e,f,g;if(isNaN(this.bufferIndex))throw haml.HamlRuntime.templateError(this.lineNumber,this.characterNumber,this.currentLine,"An internal parser error has occurred in the HAML parser");this.prevToken=this.token,this.token=null;if(this.buffer===null||this.buffer.length===this.bufferIndex)this.token={eof:!0,token:"EOF"};else{this.initLine();if(!this.token){b=this.buffer.charCodeAt(this.bufferIndex),c=this.buffer.charCodeAt(this.bufferIndex+1);if(b===10||b===13&&c===10)this.token={eol:!0,token:"EOL"},b===13&&c===10?(this.advanceCharsInBuffer(2),this.token.matched=String.fromCharCode(b)+String.fromCharCode(c)):(this.advanceCharsInBuffer(1),this.token.matched=String.fromCharCode(b)),this.characterNumber=0,this.currentLine=this.getCurrentLine()}this.matchMultiCharToken(this.tokenMatchers.whitespace,{ws:!0,token:"WS"}),this.matchMultiCharToken(this.tokenMatchers.element,{element:!0,token:"ELEMENT"},function(a){return a.substring(1)}),this.matchMultiCharToken(this.tokenMatchers.idSelector,{idSelector:!0,token:"ID"},function(a){return a.substring(1)}),this.matchMultiCharToken(this.tokenMatchers.classSelector,{classSelector:!0,token:"CLASS"},function(a){return a.substring(1)}),this.matchMultiCharToken(this.tokenMatchers.identifier,{identifier:!0,token:"IDENTIFIER"}),this.matchMultiCharToken(this.tokenMatchers.doctype,{doctype:!0,token:"DOCTYPE"}),this.token||(g=this.matchToken(this.tokenMatchers.quotedString),g||(g=this.matchToken(this.tokenMatchers.quotedString2)),g&&(this.token={string:!0,token:"STRING",tokenString:g.substring(1,g.length-1),matched:g},this.advanceCharsInBuffer(g.length))),this.matchMultiCharToken(this.tokenMatchers.comment,{comment:!0,token:"COMMENT"}),this.matchMultiCharToken(this.tokenMatchers.escapeHtml,{escapeHtml:!0,token:"ESCAPEHTML"}),this.matchMultiCharToken(this.tokenMatchers.unescapeHtml,{unescapeHtml:!0,token:"UNESCAPEHTML"}),this.matchMultiCharToken(this.tokenMatchers.objectReference,{objectReference:!0,token:"OBJECTREFERENCE"},function(a){return a.substring(1,a.length-1)});if(!this.token&&this.buffer&&this.buffer.charAt(this.bufferIndex)==="{"){e=this.bufferIndex+1,d=this.characterNumber,f=this.lineNumber,a=1;while(e<this.buffer.length&&(a>1||this.buffer.charAt(e)!=="}"))this.buffer.charAt(e)==="{"?a++:this.buffer.charAt(e)==="}"&&a--,e++;if(e===this.buffer.length){this.characterNumber=d+1,this.lineNumber=f;throw this.parseError('Error parsing attribute hash - Did not find a terminating "}"')}this.token={attributeHash:!0,token:"ATTRHASH",tokenString:this.buffer.substring(this.bufferIndex,e+1),matched:this.buffer.substring(this.bufferIndex,e+1)},this.advanceCharsInBuffer(e-this.bufferIndex+1)}this.matchSingleCharToken("(",{openBracket:!0,token:"OPENBRACKET"}),this.matchSingleCharToken(")",{closeBracket:!0,token:"CLOSEBRACKET"}),this.matchSingleCharToken("=",{equal:!0,token:"EQUAL"}),this.matchSingleCharToken("/",{slash:!0,token:"SLASH"}),this.matchSingleCharToken("!",{exclamation:!0,token:"EXCLAMATION"}),this.matchSingleCharToken("-",{minus:!0,token:"MINUS"}),this.matchSingleCharToken("&",{amp:!0,token:"AMP"}),this.matchSingleCharToken("<",{lt:!0,token:"LT"}),this.matchSingleCharToken(">",{gt:!0,token:"GT"}),this.matchSingleCharToken("~",{tilde:!0,token:"TILDE"}),this.token===null&&(this.token={unknown:!0,token:"UNKNOWN"})}return this.token},a.prototype.lookAhead=function(a){var b,c,d,e,f,g,h,i;i=null;if(a>0){e=this.token,h=this.prevToken,d=this.currentLine,g=this.lineNumber,c=this.characterNumber,b=this.bufferIndex,f=0;while(f++<a)i=this.getNextToken();this.token=e,this.prevToken=h,this.currentLine=d,this.lineNumber=g,this.characterNumber=c,this.bufferIndex=b}return i},a.prototype.initLine=function(){if(!this.currentLine&&this.currentLine!==""){this.currentLine=this.getCurrentLine(),this.lineNumber=1;return this.characterNumber=0}},a.prototype.getCurrentLine=function(a){var b;this.currentLineMatcher.lastIndex=this.bufferIndex+(a!=null?a:0),b=this.currentLineMatcher.exec(this.buffer);return b?b[0]:""},a.prototype.parseError=function(a){return haml.HamlRuntime.templateError(this.lineNumber,this.characterNumber,this.currentLine,a)},a.prototype.skipToEOLorEOF=function(){var a,b;b="",!this.token.eof&&!this.token.eol&&(this.currentLineMatcher.lastIndex=this.bufferIndex,a=this.currentLineMatcher.exec(this.buffer),a&&a.index===this.bufferIndex&&(b=a[0],this.advanceCharsInBuffer(b.length),this.getNextToken()));return b},a.prototype.advanceCharsInBuffer=function(a){var b,c,d;d=0;while(d<a)b=this.buffer.charCodeAt(this.bufferIndex+d),c=this.buffer.charCodeAt(this.bufferIndex+d+1),b===13&&c===10?(this.lineNumber++,this.characterNumber=0,this.currentLine=this.getCurrentLine(d),d++):b===10?(this.lineNumber++,this.characterNumber=0,this.currentLine=this.getCurrentLine(d)):this.characterNumber++,d++;return this.bufferIndex+=a},a.prototype.currentParsePoint=function(){return{lineNumber:this.lineNumber,characterNumber:this.characterNumber,currentLine:this.currentLine}},a.prototype.pushBackToken=function(){if(!this.token.unknown&&!this.token.eof){this.bufferIndex-=this.token.matched.length;return this.token=this.prevToken}};return a}(),a=function(){function a(a){this.generator=a,this.buffer="",this.outputBuffer=""}a.prototype.append=function(a){if(a&&a.length>0)return this.buffer+=a},a.prototype.appendToOutputBuffer=function(a){if(a&&a.length>0){this.flush();return this.outputBuffer+=a}},a.prototype.flush=function(){this.buffer&&this.buffer.length>0&&(this.outputBuffer+='    html.push("'+this.generator.escapeJs(this.buffer)+'");\n');return this.buffer=""},a.prototype.output=function(){return this.outputBuffer},a.prototype.trimWhitespace=function(){var a,b;if(this.buffer.length>0){b=this.buffer.length-1;while(b>0){a=this.buffer.charAt(b);if(a===" "||a==="\t"||a==="\n")b--;else if(b>1&&(a==="n"||a==="t")&&this.buffer.charAt(b-1)==="\\")b-=2;else break}if(b>0&&b<this.buffer.length-1)return this.buffer=this.buffer.substring(0,b+1);if(b===0)return this.buffer=""}};return a}(),d=function(){function a(){this.outputBuffer=new haml.Buffer(this)}a.prototype.appendEmbeddedCode=function(a,b,c,d,e){this.outputBuffer.flush(),this.outputBuffer.appendToOutputBuffer(a+"try {\n"),this.outputBuffer.appendToOutputBuffer(a+'    var value = eval("'+b.replace(/"/g,'\\"').replace(/\\n/g,"\\\\n")+'");\n'),this.outputBuffer.appendToOutputBuffer(a+'    value = value === null ? "" : value;'),c?this.outputBuffer.appendToOutputBuffer(a+"    html.push(haml.HamlRuntime.escapeHTML(String(value)));\n"):d?this.outputBuffer.appendToOutputBuffer(a+"    html.push(haml.HamlRuntime.perserveWhitespace(String(value)));\n"):this.outputBuffer.appendToOutputBuffer(a+"    html.push(String(value));\n"),this.outputBuffer.appendToOutputBuffer(a+"} catch (e) {\n"),this.outputBuffer.appendToOutputBuffer(a+"  throw new Error(haml.HamlRuntime.templateError("+e.lineNumber+", "+e.characterNumber+', "'+this.escapeJs(e.currentLine)+'",\n'),this.outputBuffer.appendToOutputBuffer(a+'    "Error evaluating expression - " + e));\n');return this.outputBuffer.appendToOutputBuffer(a+"}\n")},a.prototype.initOutput=function(){return this.outputBuffer.appendToOutputBuffer("  var html = [];\n  var hashFunction = null, hashObject = null, objRef = null, objRefFn = null;\n  with (context || {}) {\n")},a.prototype.closeAndReturnOutput=function(){this.outputBuffer.flush();return this.outputBuffer.output()+'  }\n  return html.join("");\n'},a.prototype.appendCodeLine=function(a,b){this.outputBuffer.flush(),this.outputBuffer.appendToOutputBuffer(a),this.outputBuffer.appendToOutputBuffer(b);return this.outputBuffer.appendToOutputBuffer("\n")},a.prototype.lineMatchesStartFunctionBlock=function(a){return a.match(/function\s\((,?\s*\w+)*\)\s*\{\s*$/)},a.prototype.lineMatchesStartBlock=function(a){return a.match(/\{\s*$/)},a.prototype.closeOffCodeBlock=function(a){this.outputBuffer.flush();return this.outputBuffer.appendToOutputBuffer(a+"}\n")},a.prototype.closeOffFunctionBlock=function(a){this.outputBuffer.flush();return this.outputBuffer.appendToOutputBuffer(a+"});\n")},a.prototype.generateCodeForDynamicAttributes=function(a,b,c,d,e,f){this.outputBuffer.flush(),d.length>0&&(d=this.replaceReservedWordsInHash(d),this.outputBuffer.appendToOutputBuffer('    hashFunction = function () { return eval("hashObject = '+d.replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"); };\n')),e.length>0&&this.outputBuffer.appendToOutputBuffer('    objRefFn = function () { return eval("objRef = '+e.replace(/"/g,'\\"')+'"); };\n');return this.outputBuffer.appendToOutputBuffer('    html.push(haml.HamlRuntime.generateElementAttributes(context, "'+a+'", ["'+b.join('","')+'"], objRefFn, '+JSON.stringify(c)+", hashFunction, "+f.lineNumber+", "+f.characterNumber+', "'+this.escapeJs(f.currentLine)+'"));\n')},a.prototype.replaceReservedWordsInHash=function(a){var b,c,d,e,f;c=a,f=["class","for"];for(d=0,e=f.length;d<e;d++)b=f[d],c=c.replace(b+":",'"'+b+'":');return c},a.prototype.escapeJs=function(a){return a.replace(/"/g,'\\"')};return a}(),b=function(){function a(){this.outputBuffer=new haml.Buffer(this)}a.prototype.appendEmbeddedCode=function(a,b,c,d,e){this.outputBuffer.flush(),this.outputBuffer.appendToOutputBuffer(a+"try {\n"),this.outputBuffer.appendToOutputBuffer(a+'    var value = eval("'+b.replace(/"/g,'\\"').replace(/\\n/g,"\\\\n")+'");\n'),this.outputBuffer.appendToOutputBuffer(a+'    value = value === null ? "" : value;'),c?this.outputBuffer.appendToOutputBuffer(a+"    html.push(haml.HamlRuntime.escapeHTML(String(value)));\n"):d?this.outputBuffer.appendToOutputBuffer(a+"    html.push(haml.HamlRuntime.perserveWhitespace(String(value)));\n"):this.outputBuffer.appendToOutputBuffer(a+"    html.push(String(value));\n"),this.outputBuffer.appendToOutputBuffer(a+"} catch (e) {\n"),this.outputBuffer.appendToOutputBuffer(a+"  throw new Error(haml.HamlRuntime.templateError("+e.lineNumber+", "+e.characterNumber+', "'+this.escapeJs(e.currentLine)+'",\n'),this.outputBuffer.appendToOutputBuffer(a+'    "Error evaluating expression - " + e));\n');return this.outputBuffer.appendToOutputBuffer(a+"}\n")},a.prototype.initOutput=function(){return this.outputBuffer.appendToOutputBuffer("  var html = [];\n  var hashFunction = null, hashObject = null, objRef = null, objRefFn = null;\n  with (context || {}) {\n")},a.prototype.closeAndReturnOutput=function(){this.outputBuffer.flush();return this.outputBuffer.output()+'  }\n  return html.join("");\n'},a.prototype.appendCodeLine=function(a,b){this.outputBuffer.flush(),this.outputBuffer.appendToOutputBuffer(a),this.outputBuffer.appendToOutputBuffer(b);return this.outputBuffer.appendToOutputBuffer("\n")},a.prototype.lineMatchesStartFunctionBlock=function(a){return a.match(/function\s\((,?\s*\w+)*\)\s*\{\s*$/)},a.prototype.lineMatchesStartBlock=function(a){return a.match(/\{\s*$/)},a.prototype.closeOffCodeBlock=function(a){this.outputBuffer.flush();return this.outputBuffer.appendToOutputBuffer(a+"}\n")},a.prototype.closeOffFunctionBlock=function(a){this.outputBuffer.flush();return this.outputBuffer.appendToOutputBuffer(a+"});\n")},a.prototype.generateCodeForDynamicAttributes=function(a,b,c,d,e,f){this.outputBuffer.flush(),d.length>0&&(d=this.replaceReservedWordsInHash(d),this.outputBuffer.appendToOutputBuffer('    hashFunction = function () { return eval("hashObject = '+d.replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"); };\n')),e.length>0&&this.outputBuffer.appendToOutputBuffer('    objRefFn = function () { return eval("objRef = '+e.replace(/"/g,'\\"')+'"); };\n');return this.outputBuffer.appendToOutputBuffer('    html.push(haml.HamlRuntime.generateElementAttributes(context, "'+a+'", ["'+b.join('","')+'"], objRefFn, '+JSON.stringify(c)+", hashFunction, "+f.lineNumber+", "+f.characterNumber+', "'+this.escapeJs(f.currentLine)+'"));\n')},a.prototype.replaceReservedWordsInHash=function(a){var b,c,d,e,f;c=a,f=["class","for"];for(d=0,e=f.length;d<e;d++)b=f[d],c=c.replace(b+":",'"'+b+'":');return c},a.prototype.escapeJs=function(a){return a.replace(/"/g,'\\"')};return a}(),c={escapeHTML:function(a){return String(a||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},perserveWhitespace:function(a){var b,c,d,e;d=/<[a-zA-Z]+>[^<]*<\/[a-zA-Z]+>/g,c="",b=0,e=d.exec(a);if(e){while(e)c+=a.substring(b,e.index),c+=e[0].replace(/\n/g,"&#x000A;"),b=e.index+e[0].length,e=d.exec(a);c+=a.substring(b)}else c=a;return c},templateError:function(a,b,c,d){var e,f;f=d+" at line "+a+" and character "+b+":\n"+c+"\n",e=0;while(e<b-1)f+="-",e++;f+="^";return f},generateElementAttributes:function(a,b,c,d,e,f,h,i,j){var k,l,m,n,o,p,q,r,s;l={},l=haml.combineAttributes(l,"id",b),c.length>0&&c[0].length>0&&(l=haml.combineAttributes(l,"class",c));if(e)for(k in e){if(!g.call(e,k))continue;l=haml.combineAttributes(l,k,e[k])}if(d)try{r=d.call(this,a),r&&(s=null,r.id?s=r.id:r.get&&(s=r.get("id")),l=haml.combineAttributes(l,"id",s),m=null,r["class"]?m=r["class"]:r.get&&(m=r.get("class")),l=haml.combineAttributes(l,"class",m))}catch(t){throw haml.HamlRuntime.templateError(h,i,j,"Error evaluating object reference - "+t)}if(f)try{p=f.call(this,a);if(p)for(k in p){if(!g.call(p,k))continue;if(k==="data"){o=p[k];for(n in o){if(!g.call(o,n))continue;l=haml.combineAttributes(l,"data-"+n,o[n])}}else l=haml.combineAttributes(l,k,p[k])}}catch(u){throw haml.HamlRuntime.templateError(h,i,j,"Error evaluating attribute hash - "+u)}q="";if(l)for(k in l){if(!g.call(l,k))continue;haml.hasValue(l[k])&&((k==="id"||k==="for")&&l[k]instanceof Array?q+=" "+k+'="'+_(l[k]).flatten().join("-")+'"':k==="class"&&l[k]instanceof Array?q+=" "+k+'="'+_(l[k]).flatten().join(" ")+'"':q+=" "+k+'="'+haml.attrValue(k,l[k])+'"')}return q}},f=this,f.haml={compileHaml:function(a){var b,c;haml.cache||(haml.cache={});if(haml.cache[a])return haml.cache[a];c=this.compileHamlToJs(new haml.Tokeniser({templateId:a}),new haml.JsCodeGenerator),b=null;try{b=new Function("context",c)}catch(d){throw"Incorrect embedded code has resulted in an invalid Haml function - "+d+"\nGenerated Function:\n"+c}return haml.cache[a]=b},compileStringToJs:function(a){var b;b=this.compileHamlToJs(new haml.Tokeniser({template:a}),new haml.JsCodeGenerator);try{return new Function("context",b)}catch(c){throw"Incorrect embedded code has resulted in an invalid Haml function - "+c+"\nGenerated Function:\n"+b}},compileHamlToJsString:function(a){var b;b="function (context) {\n",b+=this.compileHamlToJs(new haml.Tokeniser({template:a}),new haml.JsCodeGenerator);return b+="}\n"},compileHamlToJs:function(a,b){var c,d;c=[],b.initOutput(),a.getNextToken();while(!a.token.eof)a.token.eol?a.getNextToken():(d=haml.whitespace(a),a.token.doctype?haml.doctype(a,d,b):a.token.exclamation?haml.ignoredLine(a,d,c,b):a.token.equal||a.token.escapeHtml||a.token.unescapeHtml||a.token.tilde?haml.embeddedJs(a,d,c,{innerWhitespace:!0},b):a.token.minus?haml.jsLine(a,d,c,b):a.token.comment||a.token.slash?haml.commentLine(a,d,c,b):a.token.amp?haml.escapedLine(a,d,c,b):haml.templateLine(a,c,d,b));haml.closeElements(0,c,a,b);return b.closeAndReturnOutput()},doctype:function(a,b,c){var d,e;if(a.token.doctype){c.outputBuffer.append(haml.indentText(b)),a.getNextToken(),d=a.skipToEOLorEOF();if(d&&d.length>0){e=d.split(/\s+/);switch(e[0]){case"XML":e.length>1?c.outputBuffer.append("<?xml version='1.0' encoding='"+e[1]+"' ?>"):c.outputBuffer.append("<?xml version='1.0' encoding='utf-8' ?>");break;case"Strict":c.outputBuffer.append('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">');break;case"Frameset":c.outputBuffer.append('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">');break;case"5":c.outputBuffer.append("<!DOCTYPE html>");break;case"1.1":c.outputBuffer.append('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">');break;case"Basic":c.outputBuffer.append('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML Basic 1.1//EN" "http://www.w3.org/TR/xhtml-basic/xhtml-basic11.dtd">');break;case"Mobile":c.outputBuffer.append('<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.2//EN" "http://www.openmobilealliance.org/tech/DTD/xhtml-mobile12.dtd">');break;case"RDFa":c.outputBuffer.append('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML+RDFa 1.0//EN" "http://www.w3.org/MarkUp/DTD/xhtml-rdfa-1.dtd">')}}else c.outputBuffer.append('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">');return c.outputBuffer.append("\\n")}},commentLine:function(a,b,c,d){var e,f;if(a.token.comment){a.skipToEOLorEOF(),a.getNextToken(),f=haml.whitespace(a);while(!a.token.eof&&f>b)a.skipToEOLorEOF(),a.getNextToken(),f=haml.whitespace(a);return a.pushBackToken()}if(a.token.slash){haml.closeElements(b,c,a,d),d.outputBuffer.append(haml.indentText(b)),d.outputBuffer.append("<!--"),e=a.skipToEOLorEOF(),e&&e.length>0&&d.outputBuffer.append(e),e&&_(e).startsWith("[")&&e.match(/\]\s*$/)?(c[b]={htmlConditionalComment:!0},d.outputBuffer.append(">")):c[b]={htmlComment:!0};if(haml.tagHasContents(b,a))return d.outputBuffer.append("\\n")}},escapedLine:function(a,b,c,d){var e;if(a.token.amp){haml.closeElements(b,c,a,d),d.outputBuffer.append(haml.indentText(b)),e=a.skipToEOLorEOF(),e&&e.length>0&&d.outputBuffer.append(haml.HamlRuntime.escapeHTML(e));return d.outputBuffer.append("\\n")}},ignoredLine:function(a,b,c,d){var e;if(a.token.exclamation){a.getNextToken(),a.token.ws&&(b+=haml.whitespace(a)),a.pushBackToken(),haml.closeElements(b,c,a,d),e=a.skipToEOLorEOF();return d.outputBuffer.append(haml.indentText(b)+e+"\\n")}},embeddedJs:function(a,b,c,d,e){var f,g,h,i,j;c&&haml.closeElements(b,c,a,e);if(a.token.equal||a.token.escapeHtml||a.token.unescapeHtml||a.token.tilde){g=a.token.escapeHtml||a.token.equal,j=a.token.tilde,f=a.currentParsePoint(),h=a.skipToEOLorEOF(),i=haml.indentText(b),(!d||d.innerWhitespace)&&e.outputBuffer.append(i),e.appendEmbeddedCode(i,h,g,j,f);if(!d||d.innerWhitespace)return e.outputBuffer.append("\\n")}},jsLine:function(a,b,c,d){var e;if(a.token.minus){haml.closeElements(b,c,a,d),e=a.skipToEOLorEOF(),d.appendCodeLine(haml.indentText(b),e);if(d.lineMatchesStartFunctionBlock(e))return c[b]={fnBlock:!0};if(d.lineMatchesStartBlock(e))return c[b]={block:!0}}},templateLine:function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n;a.token.eol||haml.closeElements(c,b,a,d),l=haml.element(a),k=haml.idSelector(a),g=haml.classSelector(a),m=haml.objectReference(a),e=haml.attributeList(a),i=a.currentParsePoint(),f=haml.attributeHash(a),n={selfClosingTag:!1,innerWhitespace:!0,outerWhitespace:!0},a.token.slash&&(n.selfClosingTag=!0,a.getNextToken()),a.token.gt&&haml.lineHasElement(l,k,g)&&(n.outerWhitespace=!1,a.getNextToken()),a.token.lt&&haml.lineHasElement(l,k,g)&&(n.innerWhitespace=!1,a.getNextToken()),haml.lineHasElement(l,k,g)?(n.selfClosingTag||(n.selfClosingTag=haml.isSelfClosingTag(l)&&!haml.tagHasContents(c,a)),haml.openElement(i,c,l,k,g,m,e,f,b,n,d)):!haml.isEolOrEof(a)&&!a.token.ws&&a.pushBackToken(),h=haml.elementContents(a,c+1,n,d),haml.eolOrEof(a);if(n.selfClosingTag&&h.length>0)throw haml.HamlRuntime.templateError(i.lineNumber,i.characterNumber,i.currentLine,"A self-closing tag can not have any contents");if(h.length>0){h.match(/^\\%/)&&(h=h.substring(1));if(n.innerWhitespace&&haml.lineHasElement(l,k,g)||!haml.lineHasElement(l,k,g)&&haml.parentInnerWhitespace(b,c)){j=c,l.length>0&&(j+=1);return d.outputBuffer.append(haml.indentText(j)+h+"\\n")}return d.outputBuffer.append(_(h).trim()+"\\n")}if(!haml.lineHasElement(l,k,g)&&n.innerWhitespace)return d.outputBuffer.append(haml.indentText(c)+"\\n")},elementContents:function(a,b,c,d){var e;e="",a.token.eof||(a.token.ws&&a.getNextToken(),a.token.exclamation?e=a.skipToEOLorEOF():a.token.equal||a.token.escapeHtml||a.token.unescapeHtml?haml.embeddedJs(a,b,null,c,d):a.token.eol||(a.pushBackToken(),e=a.skipToEOLorEOF()));return e},attributeHash:function(a){var b;b="",a.token.attributeHash&&(b=a.token.tokenString,a.getNextToken());return b},objectReference:function(a){var b;b="",a.token.objectReference&&(b=a.token.tokenString,a.getNextToken());return b},attributeList:function(a){var b,c;c={};if(a.token.openBracket){a.getNextToken();while(!a.token.closeBracket){b=haml.attribute(a),b?c[b.name]=b.value:a.getNextToken();if(a.token.ws||a.token.eol)a.getNextToken();else if(!a.token.closeBracket&&!a.token.identifier)throw a.parseError("Expecting either an attribute name to continue the attibutes or a closing bracket to end")}a.getNextToken()}return c},attribute:function(a){var b,c;b=null;if(a.token.identifier){c=a.token.tokenString,a.getNextToken(),haml.whitespace(a);if(!a.token.equal)throw a.parseError("Expected '=' after attribute name");a.getNextToken(),haml.whitespace(a);if(!a.token.string&&!a.token.identifier)throw a.parseError("Expected a quoted string or an identifier for the attribute value");b={name:c,value:a.token.tokenString},a.getNextToken()}return b},closeElement:function(a,b,c,d){var e,f;if(b[a]){b[a].htmlComment?d.outputBuffer.append(haml.indentText(a)+"-->\\n"):b[a].htmlConditionalComment?d.outputBuffer.append(haml.indentText(a)+"<![endif]-->\\n"):b[a].block?(!c.token.minus||!c.matchToken(/\s*\}/g))&&d.closeOffCodeBlock(haml.indentText(a)):b[a].fnBlock?(!c.token.minus||!c.matchToken(/\s*\}/g))&&d.closeOffFunctionBlock(haml.indentText(a)):(e=!b[a].tagOptions||b[a].tagOptions.innerWhitespace,e?d.outputBuffer.append(haml.indentText(a)):d.outputBuffer.trimWhitespace(),d.outputBuffer.append("</"+b[a].tag+">"),f=!b[a].tagOptions||b[a].tagOptions.outerWhitespace,haml.parentInnerWhitespace(b,a)&&f&&d.outputBuffer.append("\\n"));return b[a]=null}},closeElements:function(a,b,c,d){var e,f;e=b.length-1,f=[];while(e>=a)f.push(haml.closeElement(e--,b,c,d));return f},openElement:function(a,b,c,d,e,f,g,h,i,j,k){var l,m,n;l=c.length===0?"div":c,m=haml.parentInnerWhitespace(i,b),n=!j||j.outerWhitespace,n||k.outputBuffer.trimWhitespace(),b>0&&m&&n&&k.outputBuffer.append(haml.indentText(b)),k.outputBuffer.append("<"+l),h.length>0||f.length>0?k.generateCodeForDynamicAttributes(d,e,g,h,f,a):k.outputBuffer.append(haml.HamlRuntime.generateElementAttributes(null,d,e,null,g,null,a.lineNumber,a.characterNumber,a.currentLine));if(j.selfClosingTag){k.outputBuffer.append("/>");if(j.outerWhitespace)return k.outputBuffer.append("\\n")}else{k.outputBuffer.append(">"),i[b]={tag:l,tagOptions:j};if(j.innerWhitespace)return k.outputBuffer.append("\\n")}},combineAttributes:function(a,b,c){var d;haml.hasValue(c)&&(b==="id"&&c.toString().length>0?a&&a.id instanceof Array?a.id.unshift(c):a&&a.id?a.id=[a.id,c]:a?a.id=c:a={id:c}:b==="for"&&c.toString().length>0?a&&a["for"]instanceof Array?a["for"].unshift(c):a&&a["for"]?a["for"]=[a["for"],c]:a?a["for"]=c:a={"for":c}:b==="class"?(d=[],c instanceof Array?d=d.concat(c):d.push(c),a&&a["class"]?a["class"]=a["class"].concat(d):a?a["class"]=d:a={"class":d}):b!=="id"&&(a||(a={}),a[b]=c));return a},isSelfClosingTag:function(a){return a==="meta"||a==="img"||a==="link"||a==="script"||a==="br"||a==="hr"},tagHasContents:function(a,b){var c;if(!haml.isEolOrEof(b))return!0;c=b.lookAhead(1);return c.ws&&c.tokenString.length/2>a},parentInnerWhitespace:function(a,b){return b===0||!a[b-1]||!a[b-1].tagOptions||a[b-1].tagOptions.innerWhitespace},lineHasElement:function(a,b,c){return a.length>0||b.length>0||c.length>0},hasValue:function(a){return a!=null&&a!==!1},attrValue:function(a,b){return a==="selected"||a==="checked"||a==="disabled"?a:b},indentText:function(a){var b,c;c="",b=0;while(b<a)c+="  ",b++;return c},whitespace:function(a){var b;b=0,a.token.ws&&(b=a.token.tokenString.length/2,a.getNextToken());return b},element:function(a){var b;b="",a.token.element&&(b=a.token.tokenString,a.getNextToken());return b},eolOrEof:function(a){if(a.token.eol)return a.getNextToken();if(!a.token.eof)throw a.parseError("Expected EOL or EOF")},idSelector:function(a){var b;b="",a.token.idSelector&&(b=a.token.tokenString,a.getNextToken());return b},classSelector:function(a){var b;b=[];while(a.token.classSelector)b.push(a.token.tokenString),a.getNextToken();return b},isEolOrEof:function(a){return a.token.eol||a.token.eof}},f.haml.Tokeniser=e,f.haml.Buffer=a,f.haml.JsCodeGenerator=d,f.haml.HamlRuntime=c}).call(this)